<!DOCTYPE html>
<html>
	<meta charset="UTF-8">   
<canvas id="c" width='400' height='400'></canvas>
<script src="ShaderProgramCreator.js"></script>

<script id="vertexShader" type="x-shader">
	attribute vec2 vertexPostion;
	varying vec2 textCoord;

	void main() { 
		textCoord = vertexPostion;
		gl_Position = vec4(vertexPostion, 0, 1); 
	}
</script>
<script id="fragmentShader" type="x-shader">
	precision mediump float;
	varying vec2 textCoord;
	uniform sampler2D sampler;
	void main() { 
		gl_FragColor = texture2D(sampler, textCoord); 
	}
</script>


<script>
//window.onerror = function(msg, lineno, url){
//	alert(url + "\n" + "Line number " + lineno + "\n" + msg);
//}
		var c = document.getElementById('c');
		var gl = c.getContext('experimental-webgl');
		var vertexPosBuffer = ScreenQuad();
		var vertexPosBuffer = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, vertexPosBuffer);
		var vertices = [-1, -1, 1, -1, -1, 1, 1, 1];
		gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
	
		var vs = document.getElementById('vertexShader').textContent;
		var fs = document.getElementById('fragmentShader').textContent;

		var program = createProgram(vs,fs);
		gl.useProgram(program);
		program.vertexPosAttrib = gl.getAttribLocation(program, 'vertexPostion');
		program.samplerUniform = gl.getUniformLocation(program, 'sampler');
		gl.enableVertexAttribArray(program.vertexPosArray);
		gl.vertexAttribPointer(program.vertexPosAttrib, vertexPosBuffer.numItems, gl.FLOAT, false, 0,0);


		var texture = gl.createTexture();
		var img = new Image();
		img.onLoad = function(){
			gl.activeTexture(gl.TEXTURE0);
			gl.bindTexture(gl.TEXTURE_2d, texture);
			gl.pixelStorei(gl.UNPACK_FLIP_y_wEBGL, true);
			gl.textureImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);
			gl.textParameteri(gl.Texture_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
			gl.textParameteri(gl.Texture_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
			gl.uniformli(program.samplerUniform, 0);
			gl.drawArrays(gl.TRIANGLE_STRIP, vertexPosBuffer.numItems);
		}



		img.src = "opera.png";
</script>
</html>