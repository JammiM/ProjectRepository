<!DOCTYPE html>
<html lang="en">
	<meta charset="UTF-8"> 
<head>
		<style type="text/css">
			body {
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
				font-family: Arial, Helvetica, sans-serif;
				font-size: 16px;
				text-align: center;
			}
			#info {
				color: #fff;
				text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
				position: absolute;
				top: 0px;
				width: 100%;
				padding: 5px;
				z-index: 100;
			}

		</style>
</head>
<body>
			<div id="info"></div>
<script src="Three.js"></script>
		<script src="Detector.js"></script>
		<script src="RequestAnimationFrame.js"></script>
		<script src="Stats.js"></script>
		<!--<div id="numOfCubes">Number of cubes.</div> --> 
		<script>

			var CUBE_SIZE = 250;
			var INCREASEBYNUMBER = 1;
			var DISTANCE = 1000;
			var MATERIAL_NUMBER = 30;
			
			var scene;
			var renderer;
			var camera;
			var stats;
			var cubes = [];
			var materials =[];
			var cubeHolder;
			var cubeCount = 0;
			var geometry;
			var rotSpeed;			
			var windowHalfX;
			var windowHalfY;


			initialise();

			function initialise(){
				var container = document.createElement('div');
				document.body.appendChild(container);
				renderer = new THREE.WebGLRenderer({
					antialias : false,
					clearAlpha : 0
				});
				container.appendChild(renderer.domElement);


				camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 20, 4000);
				camera.position.z =3000;




				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
				renderer.setClearColorHex( 0x000000, 1 );





				scene = new THREE.Scene();
				scene.add(camera);

				cubeHolder = new THREE.Object3D();
				scene.add(cubeHolder);				




				var light = new THREE.PointLight(0xffeeaa, 1);
				light.position = new THREE.Vector3(-1000, 1000, -1000);
				scene.add(light);


				var light2 = new THREE.PointLight(0xFFFFFF, 1);
				light2.position = new THREE.Vector3(1000, 1000, 1000);
				scene.add(light2);


				for(var i = 0; i < MATERIAL_NUMBER; i++) {
					var material = new THREE.MeshLambertMaterial({
						opacity : 1,
						blending : THREE.AdditiveBlending,
						depthTest : false,
						transparent : false
					});
					materials.push(material)
				}

				rotSpeed = .3 / 360 * Math.PI * 2;

				geometry = new THREE.CubeGeometry(CUBE_SIZE, CUBE_SIZE, CUBE_SIZE);

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				container.appendChild(stats.domElement);

				addCubes();
				
				window.addEventListener('buttonPress', onButtonPress, false);

				update();


			}//initialise
			function addCubes(){
				//init cubes

				cubeCount += INCREASEBYNUMBER;

				for(var j = 0; j < INCREASEBYNUMBER; j++) {
					var cube = new THREE.Mesh(geometry,  materials[j % MATERIAL_NUMBER]);
					

					cubeHolder.add(cube);
					cubes.push(cube);

					cube.position.x = Math.random() * DISTANCE - DISTANCE / 2;
					cube.position.y = Math.random() * DISTANCE - DISTANCE / 2;
					cube.position.z = Math.random() * DISTANCE - DISTANCE / 2;

				}//loopEnd

				document.getElementById("info").innerText = "WebGL Cubes. Rendering " + cubeCount + " cubes. Press spacebar to increase.";

			}//addCubes
			function onButtonPress(event){
				if(event.keyCode == '32'){
					addCubes();
				}
				}//buttonPress
			function update(){
				requestAnimationFrame(update);
				render();
				stats.update();
			}
			
			function render(){



				camera.lookAt(cubeHolder.position);
				
				for(var i = 0; i < cubeCount; i++) {
					cubes[i].rotation.x += rotSpeed;
				}
				renderer.render(scene, camera);
			}
		</script>
<canvas></canvas>
</body>
</html>